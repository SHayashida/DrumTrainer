# Drum Trainer CLI (Local MVP)

ドラム練習用の伴奏音源をローカルで生Eする CLI です。指定した楽曲をEーカル/ドラム/ベEス/そE他に刁Eし、ドラムをミュート（またE減衰Eした伴奏とクリチEを重ねた音源を作れます、EPM と拍位置も解析し `metadata.json` に保存します、E
## 特長
- Demucs による高品質スチE刁EEローカル実行！E- BPM/ビEト解析！EibrosaEE- クリチE生EとオーチEオ合EEEydubEE- すべてローカル完結E CLI

## 動作環墁E- macOS (Apple Silicon/M2 含む) またE Linux
- Python 3.10+
- FFmpegEエンコーチEチEードに使用EE  - macOS: `brew install ffmpeg`
  - Linux: `sudo apt-get install ffmpeg` 筁E- 初回のみ Demucs のモチEがダウンロードされます（オンラインEE
> 法的注愁E 入力音源E忁Eユーザーが合法的に所持E処琁E能な篁Eで使用してください。E動ダウンロード等E機Eは含みません、E
## セチEアチEE
```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\\Scripts\\activate
pip install --upgrade pip
pip install -r requirements.txt
```

Demucs 実行に PyTorch が忁Eです。環墁Eよっては手動でのインストEルが忁Eな場合があります。インストEルに失敗する場合E公式ドキュメントをご確認ください、E
## チEレクトリ構E
```
project/
  app.py                # CLI 本佁E  requirements.txt
  README.md
  .env.example          # 拡張用のダミE設宁E  outputs/              # 実行時に生EEE動！E```

## 使ぁE
以下E3コマンドを提供します、E
### 1) スチE刁E
```bash
python app.py separate /path/to/song.wav \
  --model htdemucs \
  --out-dir ./outputs/<auto>
```
- 入力E `.wav/.mp3/.m4a` など。E部で `mix.wav`EE4.1kHz/16bit/スチEオEに正規化されます、E- Demucs を実行し `vocals.wav, drums.wav, bass.wav, other.wav` をE力します、E- 出力Eの既定E `./outputs/<曲吁E` です、E
### 2) 解析！EPM/ビEト！E```bash
python app.py analyze ./outputs/<song-name>/mix.wav
```
- `metadata.json` に `{"bpm": float, "beats": [seconds...]}` を保存します、E- 結果はチEEブルでも表示します、E
### 3) 伴奏生成（ドラムミュート＋クリチEEE```bash
python app.py make-backing ./outputs/<song-name>/ \
  --auto-bpm \
  --with-click \
  --drum-gain -120   # 完Eミュート、E24 等で減衰に変更可能 \
  --mp3              # 任愁E MP3 もE劁E```
- `vocals+bass+other(+drums[gain])` を合成し `backing.wav` を生成します、E- `--auto-bpm` 持E時は `metadata.json` のビEト、なければオンザフライで推定します、E- `--bpm` を指定すると固定テンポEクリチEを生成できます！E--auto-bpm` なしE場合）、E
## 受け入れ基準（目安！E- 1曲を通してクラチEュせず完走
- `backing.wav` がE瞭にドラム無/減衰で再生できる
- `metadata.json` に `bpm` と `beats`E秒）が保存される
- README から初見で 5 刁E冁E実行できる

## トラブルシューチEング
- Demucs 失敁E PyTorch のインストEルめEチEDLに失敗してぁE可能性。`pip show demucs` と PyTorch の導Eを確認、E- FFmpeg 未導E: 変換めEMP3 出力に失敗します。`ffmpeg -version` で確認し、インストEルしてください、E- オーチEオ歪み: 入力クリチEEが大きい場合があります。`--drum-gain` を調整、生成後に正規化E本CLIは -1dBFS 付近に調整E、E- 出力が見つからなぁE `./outputs/<song>/` 以下に `mix.wav` と 4 stems が揃ってぁEか確認、E
## 今後E拡張
- AB ループ、段階テンポ、E/-3% 反復練翁E- GUIEEySide6Eでの再生・ループEゲイン調整
- Rubber Band による高品質ストレチE/移調
- ワーカー化！Eelery/RedisEでのバッチE琁E
---
こEリポジトリはローカル実行を前提としてぁEす。バグ報告や改喁E案E歓迎です、E
