# AGENTS.md

このファイルは、エージェント（AI開発アシスタント）が本リポジトリ内で作業する際の **ルール** と **手順** を定めるものです。  
**コミット必須・日本語コメント** を標準とします。

---

## 0) 役割と前提
- あなた（エージェント）は、ユーザーが与えるタスクを **現在の作業ディレクトリ内の Git リポジトリ** で完了します。
- タスクの達成に必要なコマンドは **完了（または明示的に停止）** させてから終了してください。
- **外部への送信・アップロード** は、ユーザーの明示許可がない限り行いません。

---

## 1) Git 運用ルール（必須）
- **新しいブランチは作成しない**（`main/master` 等で直接コミット）。
- 作業終了時、`git status` が **クリーン**（変更なし）であること。
- 変更があれば必ず **コミット** すること（作業途中でも論理単位で小さくコミット可）。
- **既存コミットの改変（--amend / rebase）禁止**。履歴は保持する。
- `pre-commit` や CI が失敗したら、**修正して再実行** → パスするまで繰り返す。
- 最後に `git status` と `git log -1` を確認して終了。

**コミットメッセージ規約（日本語）**  
- 1行目：要約（50文字以内目安、命令形）  
- 空行  
- 本文：変更理由・影響範囲・テスト結果（必要に応じて箇条書き）

例：
- ドラム練習MVPにクリック生成を追加
- librosaでビート検出しクリック波形を合成
- drumlessバックトラックに-6dBで重畳
- pre-commit通過、ローカル再生確認済み

---

## 2) コード記述ポリシー（日本語コメント）
- **コード内コメント、README、PRメッセージは日本語** で記載してください（プロジェクトで英語が明示されている場合を除く）。
- 既存のスタイルがある場合はそれに **完全準拠**（フォーマッタ・リンタ設定含む）。
- 依存追加時は `requirements.txt` / `pyproject.toml` / `package.json` 等を更新し、インストール手順を README に追記。

---

## 3) 実行・検証（必須）
- **プログラム的チェックが存在する場合、必ず実行**：`pre-commit`, `lint`, `format`, `test`, `build`, `type-check` 等。
- 変更が小さくても **全部のチェック** を回し、**エラーゼロ** を確認。
- 実行コマンド例（プロジェクトに合わせて選択）：
  - Python: `pre-commit run -a`, `ruff check .`, `black --check .`, `pytest -q`, `mypy .`
  - Node: `npm run lint`, `npm run test`, `npm run build`
- 実行方法・テスト方法が不明な場合は、`README.md` に追記・整備してから作業。

---

## 4) 変更範囲と優先順位
1. **既存の仕様・API・I/O契約を壊さない**（後方互換を最優先）。
2. セキュリティ（機密情報・キー・個人情報）を露出しない。
3. パフォーマンス/可読性/保守性を改善する場合は、**小さな差分で段階的** に。
4. 迷ったら **小さく安全に**。大改修は最小実装→段階拡張。

---

## 5) AGENTS.md のスコープと優先度
- 本ファイルが置かれたフォルダを **ルート** とし、その配下の全ディレクトリに適用。
- より深い階層に別の `AGENTS.md` がある場合、**そちらを優先**。
- **ユーザーの直接指示 > AGENTS.md**（矛盾時はユーザー指示に従う）。

---

## 6) PR / 変更要約メッセージ（日本語）
※PR 作成ワークフローがある場合に従う。なければ、最終回答時に以下を準拠して概要を記載。

**テンプレート**
### 目的
（タスクの目的を1-2文で）

### 変更内容
主要変更点（箇条書き）
追加/更新ファイル

### 実行方法
セットアップ手順
コマンド例

### チェック項目
 pre-commit / lint / test すべてパス
 既存API・I/O契約を破壊していない
 ドキュメントを更新済み

### 影響範囲
（互換性、依存、環境変数、パフォーマンス等）

### 備考
（制約・既知の課題・次の改良案など）

---

## 7) 参考（任意の評価環境で要求される場合の「引用ルール」）
- ファイルを根拠として示す場合： `【F:<path>†L<start>(-L<end>)?】`
- ターミナル出力を根拠として示す場合： `【<chunk_id>†L<start>(-L<end>)?】`
- 行番号は1始まり。空行は引用しない。  
※必要な環境でのみ使用。通常の開発では不要。

---

## 8) 禁止事項
- 無断のブランチ作成・履歴書き換え（rebase, amend）
- ライセンス不明のコードやアセットの取り込み
- 機微情報（鍵・トークン等）の平文コミット
- 外部送信（アップロード・依存自動送信）※明示許可がある場合を除く

---

## 9) 例：Python プロジェクトの既定ツール（なければ導入）
- フォーマット：`black` / `isort`
- Lint：`ruff`
- 型：`mypy`
- Hooks：`pre-commit`
- テスト：`pytest`
- 手順：
  1) `pre-commit install`
  2) `pre-commit run -a`
  3) `pytest -q`

---

## 10) 最終チェックリスト
- [ ] `git status` がクリーン（変更なし）
- [ ] 直近コミットに要約・理由・検証結果を日本語で記載
- [ ] すべてのチェックに合格
- [ ] README/ドキュメント更新済み